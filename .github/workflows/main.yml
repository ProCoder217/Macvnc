name: Mac VNC Working (Ventura)

on:
  workflow_dispatch:

jobs:
  vnc-mac-13:
    # ğŸ”´ SABSE ZAROORI: macos-13 use karna hai (Sonoma me VNC block hota hai)
    runs-on: macos-13

    steps:
    - name: ğŸ”‘ Create Admin User (For Login)
      run: |
        # Admin user create kar rahe hain
        sudo sysadminctl -addUser adminuser -fullName "Admin User" -password "SecretPass123!" -admin

    - name: ğŸ› ï¸ Enable VNC (Legacy Mode)
      run: |
        echo "Enabling VNC..."
        
        # Ye command VNC ko force enable karegi with password
        sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart \
          -activate -configure -access -on \
          -clientopts -setvnclegacy -vnclegacy yes \
          -clientopts -setvncpw -vncpw "SecretPass123!" \
          -restart -agent -privs -all
        
        echo "âœ… VNC enabled."

    - name: ğŸ›‘ Disable Sleep & Lock
      run: |
        sudo systemsetup -setremotelogin on
        sudo systemsetup -setcomputersleep Never
        sudo systemsetup -setdisplaysleep Never
        
        # Screen lock disable kar rahe hain
        defaults write com.apple.screensaver askForPassword -int 0
        defaults write com.apple.screensaver idleTime -int 0
        sudo defaults write /Library/Preferences/com.apple.loginwindow AdminHostInfo HostName

    - name: ğŸš€ Start Tunnel (Bore)
      run: |
        brew install bore-cli
        echo "------------------------------------------------"
        echo "ğŸ”— CONNECT TO THIS URL IN VNC VIEWER:"
        echo "ğŸ”‘ PASSWORD: SecretPass123!"
        echo "------------------------------------------------"
        
        # Port 5900 ko tunnel kar rahe hain
        bore local 5900 --to bore.pub
